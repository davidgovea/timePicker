/*
 * A time picker for jQuery
 *
 * Dual licensed under the MIT and GPL licenses.
 * Copyright (c) 2009 Anders Fajerson
 * @name     timePicker
 * @author   Anders Fajerson (http://perifer.se)
 * @example  $("#mytime").timePicker();
 * @example  $("#mytime").timePicker({step:30, startTime:"15:00", endTime:"18:00"});
 *
 * Based on timePicker by Sam Collet (http://www.texotela.co.uk/code/jquery/timepicker/)
 *
 * Options:
 *   step: # of minutes to step the time by
 *   startTime: beginning of the range of acceptable times
 *   endTime: end of the range of acceptable times
 *   separator: separator string to use between hours and minutes (e.g. ':')
 *   show24Hours: use a 24-hour scheme
 */(function(e){function t(t,n,r,i){t.value=e(n).text(),e(t).change(),e.browser.msie||t.focus(),r.hide()}function n(e,t){var n=e.getHours(),i=t.show24Hours?n:(n+11)%12+1,s=e.getMinutes();return(t.leadingZero?r(i):i)+t.separator+r(s)+(t.show24Hours?"":n<12?" AM":" PM")}function r(e){return(e<10?"0":"")+e}function i(e,t){return typeof e=="object"?o(e):s(e,t)}function s(e,t){if(e){var n=e.split(t.separator),r=parseFloat(n[0]),i=parseFloat(n[1]);t.show24Hours||(r===12&&e.indexOf("AM")!==-1?r=0:r!==12&&e.indexOf("PM")!==-1&&(r+=12));var s=new Date(0,0,0,r,i,0);return o(s)}return null}function o(e){return e.setFullYear(2001),e.setMonth(0),e.setDate(0),e}e.fn.timePicker=function(t){var n=e.extend({},e.fn.timePicker.defaults,t);return this.each(function(){e.timePicker(this,n)})},e.timePicker=function(t,n){var r=e(t)[0];return r.timePicker||(r.timePicker=new jQuery._timePicker(r,n))},e.timePicker.version="0.3",e._timePicker=function(r,u){var a=!1,f=!1,l=i(u.startTime,u),c=i(u.endTime,u),h="selected",p="li."+h;e(r).attr("autocomplete","OFF");var d=[],v=new Date(l);while(v<=c)d[d.length]=n(v,u),v=new Date(v.setMinutes(v.getMinutes()+u.step));var m=e('<div class="time-picker'+(u.show24Hours?"":" time-picker-12hours")+'"></div>'),g=e("<ul></ul>");for(var y=0;y<d.length;y++)g.append("<li>"+d[y]+"</li>");m.append(g),m.appendTo("body").hide(),m.mouseover(function(){a=!0}).mouseout(function(){a=!1}),e("li",g).mouseover(function(){f||(e(p,m).removeClass(h),e(this).addClass(h))}).mousedown(function(){a=!0}).click(function(){t(r,this,m,u),a=!1});var b=function(){if(m.is(":visible"))return!1;e("li",m).removeClass(h);var t=e(r).offset();m.css({top:t.top+r.offsetHeight,left:t.left}),m.show();var i=r.value?s(r.value,u):l,a=l.getHours()*60+l.getMinutes(),f=i.getHours()*60+i.getMinutes()-a,p=Math.round(f/u.step),d=o(new Date(0,0,0,0,p*u.step+a,0));d=l<d&&d<=c?d:l;var v=e("li:contains("+n(d,u)+")",m);return v.length&&(v.addClass(h),m[0].scrollTop=v[0].offsetTop),!0};e(r).focus(b).click(b),e(r).blur(function(){a||m.hide()});var w=e.browser.opera||e.browser.mozilla?"keypress":"keydown";e(r)[w](function(n){var i;f=!0;var s=m[0].scrollTop;switch(n.keyCode){case 38:if(b())return!1;i=e(p,g);var o=i.prev().addClass(h)[0];return o?(i.removeClass(h),o.offsetTop<s&&(m[0].scrollTop=s-o.offsetHeight)):(i.removeClass(h),o=e("li:last",g).addClass(h)[0],m[0].scrollTop=o.offsetTop-o.offsetHeight),!1;case 40:if(b())return!1;i=e(p,g);var a=i.next().addClass(h)[0];return a?(i.removeClass(h),a.offsetTop+a.offsetHeight>s+m[0].offsetHeight&&(m[0].scrollTop=s+a.offsetHeight)):(i.removeClass(h),a=e("li:first",g).addClass(h)[0],m[0].scrollTop=0),!1;case 13:if(m.is(":visible")){var l=e(p,g)[0];t(r,l,m,u)}return!1;case 27:return m.hide(),!1}return!0}),e(r).keyup(function(e){f=!1}),this.getTime=function(){return s(r.value,u)},this.setTime=function(t){r.value=n(i(t,u),u),e(r).change()}},e.fn.timePicker.defaults={step:15,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),separator:":",show24Hours:!1,leadingZero:!1}})(jQuery);